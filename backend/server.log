/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
✅ Audio processing available
✅ PDF processing available
 * Serving Flask app 'app'
 * Debug mode: on
[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.250.112:5001
[33mPress CTRL+C to quit[0m
 * Restarting with stat
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
 * Debugger is active!
 * Debugger PIN: 130-091-692
127.0.0.1 - - [12/Aug/2025 21:01:28] "[33mHEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/1?type=thumbnail HTTP/1.1[0m" 404 -
 * Detected change in '/Users/parthshah/Desktop/projects/ai-math-tutor/backend/pdf_image_service.py', reloading
✅ Audio processing available
✅ PDF processing available
 * Restarting with stat
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
 * Debugger is active!
 * Debugger PIN: 130-091-692
127.0.0.1 - - [12/Aug/2025 21:02:05] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/1?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:11] "HEAD /api/audio-segment/23eb1cb1-6d5f-49a8-aa49-4721f04e8374/1 HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/1?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/1?type=full HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/2?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/2?type=full HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/3?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/3?type=full HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/4?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/slide-image/d5821c5f-1029-4730-a0cd-6c0154bd9db8/4?type=full HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:02:47] "HEAD /api/audio-segment/23eb1cb1-6d5f-49a8-aa49-4721f04e8374/1 HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:49:35] "POST /api/process-upload HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:49:48] "OPTIONS /api/assignments/uploaded_1ecc3120-61aa-400f-9c06-ed369512d1bc_airbnb-shortened.pdf/slides HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:49:48] "POST /api/assignments/uploaded_1ecc3120-61aa-400f-9c06-ed369512d1bc_airbnb-shortened.pdf/slides HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:49:58] "POST /api/chat HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:50:01] "OPTIONS /api/chat HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:50:04] "POST /api/chat HTTP/1.1" 200 -
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:198: RuntimeWarning: Couldn't find ffprobe or avprobe - defaulting to ffprobe, but may not work
  warn("Couldn't find ffprobe or avprobe - defaulting to ffprobe, but may not work", RuntimeWarning)
127.0.0.1 - - [12/Aug/2025 21:51:01] "POST /api/feedback HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:51:50] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/1?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:51:50] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/3?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:51:50] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/2?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:51:50] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/4?type=thumbnail HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:52:19] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/1?type=full HTTP/1.1" 200 -
127.0.0.1 - - [12/Aug/2025 21:52:23] "GET /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/2?type=full HTTP/1.1" 200 -
 * Detected change in '/Users/parthshah/Desktop/projects/ai-math-tutor/backend/feedback_service.py', reloading
✅ Audio processing available
✅ PDF processing available
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_1_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_1_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_1_full.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_2_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_2_full.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_3_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_3_full.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_4_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/d5821c5f-1029-4730-a0cd-6c0154bd9db8/slide_4_full.png
🔍 File exists: True
📁 Saved uploaded PDF to: /Users/parthshah/Desktop/projects/ai-math-tutor/backend/assignments/uploaded_1ecc3120-61aa-400f-9c06-ed369512d1bc_airbnb-shortened.pdf
📄 Starting PDF processing: /Users/parthshah/Desktop/projects/ai-math-tutor/backend/assignments/uploaded_1ecc3120-61aa-400f-9c06-ed369512d1bc_airbnb-shortened.pdf
📁 PDF file exists: True
📏 PDF file size: 214843 bytes
📁 Session directory created: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc
📄 Converting PDF to images: /Users/parthshah/Desktop/projects/ai-math-tutor/backend/assignments/uploaded_1ecc3120-61aa-400f-9c06-ed369512d1bc_airbnb-shortened.pdf
✅ PDF conversion successful: 4 pages
📷 Processing slide 1...
✅ Saved slide 1
📷 Processing slide 2...
✅ Saved slide 2
📷 Processing slide 3...
✅ Saved slide 3
📷 Processing slide 4...
✅ Saved slide 4
✅ Successfully converted 4 slides
📄 Detected 4 pages in PDF
🌐 API /chat endpoint called
📋 Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryKucJiMsBBgrk1jLm
🎵 Multipart request detected - checking for audio...
🎙️ Audio file received: recording.wav
📏 Audio file size: 0 bytes
💾 Audio saved to temporary file: /var/folders/t9/90kgxqcx6wd2x1bhj5m1d0wm0000gn/T/tmp_uty3ihj.wav
🔊 Starting audio transcription with Whisper...
✅ Audio transcription successful!
📝 Transcription: Test 1, test 2, test 3, test 4.

🗑️ Temporary audio file cleaned up
🤖 AI service called
📄 PDF context provided: True
🎙️ Audio transcription provided: True
📝 Transcription length: 32 characters
📝 Transcription preview: Test 1, test 2, test 3, test 4.
...
🎯 Adding audio transcription to AI context!
🌐 API /chat endpoint called
📋 Content-Type: application/json
🤖 AI service called
📄 PDF context provided: True
🎙️ Audio transcription provided: False
📝 API /feedback endpoint called
📋 Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryTeBlQAJSAM6cYIQn
🎵 Multipart request with recording detected...
📊 Slide timestamps received: [{'slideNumber': 1, 'timestamp': 0}, {'slideNumber': 2, 'timestamp': 1.851}, {'slideNumber': 3, 'timestamp': 3.402}, {'slideNumber': 4, 'timestamp': 3.519}]
📄 PDF slide count received: 4
📄 PDF session ID received: 1ecc3120-61aa-400f-9c06-ed369512d1bc
🎙️ Recording file received: presentation.wav
📝 Generating slide-specific feedback...
💬 Conversation messages: 5
📄 Slide content provided: True
🎙️ Presentation recording provided: True
📊 Slide timestamps provided: 4
📊 Detailed timestamps: [{'slideNumber': 1, 'timestamp': 0}, {'slideNumber': 2, 'timestamp': 1.851}, {'slideNumber': 3, 'timestamp': 3.402}, {'slideNumber': 4, 'timestamp': 3.519}]
  - Timestamp 0: Slide 1, Time: 0s
  - Timestamp 1: Slide 2, Time: 1.851s
  - Timestamp 2: Slide 3, Time: 3.402s
  - Timestamp 3: Slide 4, Time: 3.519s
📄 PDF session ID: 1ecc3120-61aa-400f-9c06-ed369512d1bc
📄 PDF slide count: 4
🔊 Processing slide-specific audio segments...
❌ Audio splitting failed: [Errno 2] No such file or directory: 'ffprobe'
⚠️ Audio splitting returned only one segment, treating as full audio
📝 Created fake segment for slide 1: 7 chars
📝 Created fake segment for slide 2: 7 chars
📝 Created fake segment for slide 3: 7 chars
📝 Created fake segment for slide 4: 7 chars
📊 Final actual slide count: 4
📊 Generating per-slide feedback for 4 slides based on timestamps
📊 Slide timestamps (filtered): [{'slideNumber': 1, 'timestamp': 0}, {'slideNumber': 2, 'timestamp': 1.851}, {'slideNumber': 3, 'timestamp': 3.402}, {'slideNumber': 4, 'timestamp': 3.519}]
📊 Audio transcripts available for slides: [1, 2, 3, 4]
📊 Processing slide 1 (index 0)
📊 Using audio transcript for slide 1
✅ Successfully generated feedback for slide 1
📊 Processing slide 2 (index 1)
📊 Using audio transcript for slide 2
✅ Successfully generated feedback for slide 2
📊 Processing slide 3 (index 2)
📊 Using audio transcript for slide 3
✅ Successfully generated feedback for slide 3
📊 Processing slide 4 (index 3)
📊 Using audio transcript for slide 4
✅ Successfully generated feedback for slide 4
📊 Session IDs:
  - Feedback session (audio): a5f388cd-6b7c-4b86-8b51-29a88c7534ce
  - Image session (PDF): 1ecc3120-61aa-400f-9c06-ed369512d1bc
⚠️ Audio transcripts available but no segments to save
📊 Building slide 1 data:
  - Has audio: False
  - Audio saved at: Not saved
  - Audio URL: None
  - Image URL: /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/1?type=thumbnail
  - Image session: 1ecc3120-61aa-400f-9c06-ed369512d1bc
  - Audio session: a5f388cd-6b7c-4b86-8b51-29a88c7534ce
📊 Building slide 2 data:
  - Has audio: False
  - Audio saved at: Not saved
  - Audio URL: None
  - Image URL: /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/2?type=thumbnail
  - Image session: 1ecc3120-61aa-400f-9c06-ed369512d1bc
  - Audio session: a5f388cd-6b7c-4b86-8b51-29a88c7534ce
📊 Building slide 3 data:
  - Has audio: False
  - Audio saved at: Not saved
  - Audio URL: None
  - Image URL: /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/3?type=thumbnail
  - Image session: 1ecc3120-61aa-400f-9c06-ed369512d1bc
  - Audio session: a5f388cd-6b7c-4b86-8b51-29a88c7534ce
📊 Building slide 4 data:
  - Has audio: False
  - Audio saved at: Not saved
  - Audio URL: None
  - Image URL: /api/slide-image/1ecc3120-61aa-400f-9c06-ed369512d1bc/4?type=thumbnail
  - Image session: 1ecc3120-61aa-400f-9c06-ed369512d1bc
  - Audio session: a5f388cd-6b7c-4b86-8b51-29a88c7534ce
✅ Structured feedback generated for 4 slides
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_1_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_2_thumb.png
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_3_thumb.png
🔍 File exists: True
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_4_thumb.png
🔍 File exists: True
🔍 File exists: True
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_1_full.png
🔍 File exists: True
🔍 Looking for image at: slide_images/1ecc3120-61aa-400f-9c06-ed369512d1bc/slide_2_full.png
🔍 File exists: True
 * Restarting with stat
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
 * Debugger is active!
 * Debugger PIN: 130-091-692
 * Detected change in '/Users/parthshah/Desktop/projects/ai-math-tutor/backend/feedback_service.py', reloading
✅ Audio processing available
✅ PDF processing available
 * Restarting with stat
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
 * Debugger is active!
 * Debugger PIN: 130-091-692
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/multiprocessing/resource_tracker.py:301: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown: {'/mp-y5akt3c3'}
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/multiprocessing/resource_tracker.py:301: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown: {'/mp-x9w5htcr'}
  warnings.warn(
